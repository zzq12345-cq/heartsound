{
  "id": "IMPL-007",
  "title": "管理后台小程序 - 项目结构、认证和数据看板",
  "status": "pending",
  "meta": {
    "type": "feature",
    "agent": "@code-developer",
    "phase": 4,
    "estimated_effort": "2天"
  },
  "context": {
    "requirements": [
      "创建1个独立小程序项目: miniprogram-admin/ (包含约25个文件)",
      "实现1个管理员登录页面: pages/login (微信登录+权限验证)",
      "实现1个数据看板页面: pages/dashboard (4个统计卡片+2个图表)",
      "创建4个统计组件: [stat-card统计卡片, line-chart折线图, pie-chart饼图, search-bar搜索栏]",
      "创建2个服务模块: [services/admin.js管理员服务, services/dashboard.js看板数据服务]",
      "配置4个TabBar页面: [看板, 用户, 设备, 报表]"
    ],
    "focus_paths": [
      "miniprogram-admin/",
      "miniprogram-admin/pages/login/",
      "miniprogram-admin/pages/dashboard/",
      "miniprogram-admin/components/",
      "miniprogram-admin/services/"
    ],
    "acceptance": [
      "非管理员访问显示无权限: verify by 使用普通用户openid登录提示'无管理员权限'",
      "管理员登录成功跳转看板: verify by 有效管理员登录后自动跳转dashboard页",
      "4个统计卡片数据加载: verify by 卡片显示总用户数/总检测数/设备数量/今日检测",
      "折线图7天趋势显示: verify by 图表显示最近7天的检测趋势数据",
      "饼图风险分布显示: verify by 饼图显示safe/warning/danger三色占比",
      "看板加载<=3秒: verify by 页面完全渲染时间<3000ms"
    ],
    "depends_on": ["IMPL-001"],
    "artifacts": [
      {
        "type": "design_document",
        "path": "心音智鉴检测中心功能设计方案.md",
        "section": "十四、管理员后台模块 - 14.1至14.3",
        "priority": "highest"
      }
    ]
  },
  "flow_control": {
    "pre_analysis": [
      {
        "step": "load_admin_design",
        "action": "读取管理后台设计规范",
        "commands": ["Read(心音智鉴检测中心功能设计方案.md)"],
        "output_to": "admin_design_spec",
        "on_error": "abort"
      }
    ],
    "implementation_approach": [
      {
        "step": 1,
        "title": "创建管理后台项目骨架",
        "description": "初始化独立的管理后台小程序项目",
        "modification_points": [
          "创建1个根配置: app.json (定义4个tabBar页面)",
          "创建1个全局样式: app.wxss",
          "创建1个入口文件: app.js",
          "创建5个目录: [pages/, components/, services/, utils/, config/]"
        ],
        "logic_flow": [
          "定义管理后台专用的全局配置",
          "配置TabBar导航(看板/用户/设备/报表)",
          "定义管理后台样式变量",
          "初始化管理员认证状态"
        ],
        "depends_on": [],
        "output": "admin_skeleton"
      },
      {
        "step": 2,
        "title": "实现管理员服务模块",
        "description": "封装管理员认证和权限验证",
        "modification_points": [
          "创建1个管理员服务: services/admin.js (约100行)",
          "实现4个方法: [login(), logout(), checkPermission(), getAdminInfo()]"
        ],
        "logic_flow": [
          "调用wx.login获取code",
          "后端验证获取openid",
          "查询admins表验证权限",
          "保存admin_token到本地",
          "记录登录日志"
        ],
        "depends_on": [1],
        "output": "admin_service"
      },
      {
        "step": 3,
        "title": "实现登录页面",
        "description": "开发管理员登录和权限验证页面",
        "modification_points": [
          "创建1个页面目录: pages/login/",
          "创建4个页面文件: [index.js约100行, index.json, index.wxml约50行, index.wxss约60行]",
          "实现微信登录按钮和错误提示"
        ],
        "logic_flow": [
          "显示管理后台登录界面",
          "点击登录调用管理员服务",
          "验证成功跳转看板页",
          "验证失败提示无权限"
        ],
        "depends_on": [2],
        "output": "login_page"
      },
      {
        "step": 4,
        "title": "创建统计卡片组件",
        "description": "实现看板页的统计数据卡片",
        "modification_points": [
          "创建1个组件目录: components/stat-card/",
          "创建4个组件文件",
          "支持数值/增长率/图标的展示"
        ],
        "logic_flow": [
          "接收title/value/trend属性",
          "根据trend正负显示上升或下降箭头",
          "显示增长百分比"
        ],
        "depends_on": [],
        "output": "stat_card_component"
      },
      {
        "step": 5,
        "title": "创建图表组件",
        "description": "集成ECharts实现折线图和饼图",
        "modification_points": [
          "创建2个组件目录: [components/line-chart/, components/pie-chart/]",
          "引入echarts-for-weixin库",
          "封装7天趋势折线图",
          "封装风险分布饼图"
        ],
        "logic_flow": [
          "初始化ECharts实例",
          "接收数据属性更新图表",
          "配置图表样式(颜色/字体/动画)"
        ],
        "depends_on": [],
        "output": "chart_components"
      },
      {
        "step": 6,
        "title": "实现看板数据服务",
        "description": "封装看板数据获取逻辑",
        "modification_points": [
          "创建1个看板服务: services/dashboard.js (约80行)",
          "实现2个方法: [getSummary(), getWeeklyTrend()]"
        ],
        "logic_flow": [
          "调用Supabase聚合查询统计数据",
          "计算同比增长率",
          "查询7天检测趋势",
          "统计风险分布占比"
        ],
        "depends_on": [],
        "output": "dashboard_service"
      },
      {
        "step": 7,
        "title": "实现数据看板页面",
        "description": "开发管理后台首页看板",
        "modification_points": [
          "创建1个页面目录: pages/dashboard/",
          "创建4个页面文件: [index.js约150行, index.json, index.wxml约100行, index.wxss约80行]",
          "集成4个stat-card和2个图表组件"
        ],
        "logic_flow": [
          "页面加载验证登录状态",
          "获取看板统计数据",
          "渲染4个核心指标卡片",
          "渲染7天趋势折线图",
          "渲染风险分布饼图"
        ],
        "depends_on": [4, 5, 6],
        "output": "dashboard_page"
      }
    ],
    "target_files": [
      "miniprogram-admin/app.js",
      "miniprogram-admin/app.json",
      "miniprogram-admin/app.wxss",
      "miniprogram-admin/services/admin.js",
      "miniprogram-admin/services/dashboard.js",
      "miniprogram-admin/components/stat-card/index.js",
      "miniprogram-admin/components/stat-card/index.wxml",
      "miniprogram-admin/components/line-chart/index.js",
      "miniprogram-admin/components/pie-chart/index.js",
      "miniprogram-admin/pages/login/index.js",
      "miniprogram-admin/pages/login/index.wxml",
      "miniprogram-admin/pages/dashboard/index.js",
      "miniprogram-admin/pages/dashboard/index.wxml"
    ]
  }
}
