<!-- Index Page Template - 首页 -->
<view class="page-container">

  <!-- ========== Hero Section ========== -->
  <view class="hero">
    <view class="hero-bg-orb hero-orb-1"></view>
    <view class="hero-bg-orb hero-orb-2"></view>
    <view class="hero-content">
      <view class="hero-text">
        <text class="hero-greeting">{{greeting}}</text>
        <text class="hero-tagline">守护每一次心跳</text>
      </view>
      <view class="hero-pulse-ring">
        <view class="pulse-ring-outer"></view>
        <view class="pulse-ring-inner"></view>
        <icon-svg name="heart-pulse" size="52" color="#2E8B8B" />
      </view>
    </view>
  </view>

  <!-- ========== CTA - Start Detection ========== -->
  <view class="cta-section">
    <view
      class="cta-btn {{canStartDetection ? '' : 'cta-btn--disabled'}}"
      bindtap="onStartDetectionTap"
    >
      <view class="cta-btn-inner">
        <icon-svg name="heart" size="36" color="{{canStartDetection ? '#FFFFFF' : '#C2C7CF'}}" />
        <view class="cta-btn-text-group">
          <text class="cta-btn-label">{{canStartDetection ? '开始心音检测' : '请先连接设备'}}</text>
          <text class="cta-btn-sub" wx:if="{{canStartDetection}}">约30秒 · 安全无创</text>
        </view>
      </view>
      <icon-svg wx:if="{{canStartDetection}}" name="arrow-right" size="24" color="rgba(255,255,255,0.7)" />
    </view>
  </view>

  <!-- ========== Device Status ========== -->
  <view class="card-section">
    <view class="card-header">
      <text class="card-header-label">设备</text>
      <view class="status-pill {{deviceStatus}}">
        <view class="status-pill-dot"></view>
        <text class="status-pill-text">{{deviceStatus === 'connected' ? '在线' : '离线'}}</text>
      </view>
    </view>
    <view class="device-card {{deviceStatus}}" bindtap="onDeviceViewInfo">
      <view class="device-card-row">
        <view class="device-avatar {{deviceStatus}}">
          <icon-svg name="{{deviceStatus === 'connected' ? 'wifi' : 'wifi-off'}}" size="40" color="{{deviceStatus === 'connected' ? '#2E8B8B' : '#C2C7CF'}}" />
        </view>
        <view class="device-meta">
          <text class="device-name">{{deviceStatus === 'connected' ? '已连接设备' : '未连接设备'}}</text>
          <text class="device-detail">{{deviceStatus === 'connected' ? deviceInfo.device_name || '心音智鉴检测设备' : '请先连接树莓派设备'}}</text>
        </view>
        <view class="device-chevron" wx:if="{{deviceStatus === 'connected'}}">
          <icon-svg name="chevron-right" size="28" color="#C2C7CF" />
        </view>
      </view>
    </view>
  </view>

  <!-- ========== Connect Actions ========== -->
  <view class="card-section">
    <view class="card-header">
      <text class="card-header-label">连接方式</text>
    </view>
    <view class="connect-grid">
      <view class="connect-card" bindtap="onScanTap" bindlongpress="onLongPressScan">
        <view class="connect-card-icon scan-icon">
          <icon-svg name="scan" size="44" color="#FFFFFF" />
        </view>
        <text class="connect-card-title">扫码连接</text>
        <text class="connect-card-sub">扫描设备二维码</text>
      </view>
      <view class="connect-card" bindtap="onManualInputTap">
        <view class="connect-card-icon manual-icon">
          <icon-svg name="keyboard" size="44" color="#FFFFFF" />
        </view>
        <text class="connect-card-title">手动输入</text>
        <text class="connect-card-sub">输入设备IP地址</text>
      </view>
    </view>
  </view>

  <!-- ========== Quick Stats ========== -->
  <view class="card-section" wx:if="{{deviceStatus === 'connected' && lastDetectionResult}}">
    <view class="card-header">
      <text class="card-header-label">上次检测</text>
      <text class="card-header-sub">{{lastDetectionTime}}</text>
    </view>
    <view class="stats-row">
      <view class="stat-block">
        <text class="stat-num {{lastDetectionResult.riskLevel}}">{{lastDetectionResult.confidence}}%</text>
        <text class="stat-label">置信度</text>
      </view>
      <view class="stat-sep"></view>
      <view class="stat-block">
        <text class="stat-num {{lastDetectionResult.riskLevel}}">{{lastDetectionResult.result}}</text>
        <text class="stat-label">检测结果</text>
      </view>
    </view>
  </view>

  <!-- ========== Health Tips ========== -->
  <view class="card-section">
    <view class="card-header">
      <text class="card-header-label">健康小贴士</text>
    </view>
    <view class="tip-card">
      <swiper
        class="tip-swiper"
        autoplay="{{true}}"
        interval="{{6000}}"
        circular="{{true}}"
        indicator-dots="{{true}}"
        indicator-color="rgba(46,139,139,0.15)"
        indicator-active-color="#2E8B8B"
      >
        <swiper-item wx:for="{{healthTips}}" wx:key="id">
          <view class="tip-slide">
            <view class="tip-tag">{{item.category || '健康建议'}}</view>
            <text class="tip-body">{{item.content}}</text>
          </view>
        </swiper-item>
        <swiper-item wx:if="{{healthTips.length === 0}}">
          <view class="tip-slide">
            <view class="tip-tag">健康建议</view>
            <text class="tip-body">规律运动有助于降低静息心率，改善心脏功能。建议每周进行至少150分钟的中等强度有氧运动。</text>
          </view>
        </swiper-item>
      </swiper>
    </view>
  </view>

  <!-- ========== Footer ========== -->
  <view class="page-footer">
    <text class="footer-disclaimer">本检测结果仅供参考，不能作为诊断依据。如有不适，请及时就医。</text>
    <text class="footer-ver">心音智鉴 v1.0.0</text>
  </view>

</view>
