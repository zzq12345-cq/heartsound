{
  "id": "IMPL-004",
  "title": "微信小程序用户端 - 项目结构和首页设备连接",
  "status": "pending",
  "meta": {
    "type": "feature",
    "agent": "@code-developer",
    "phase": 3,
    "estimated_effort": "2天"
  },
  "context": {
    "requirements": [
      "创建1个微信小程序项目结构: miniprogram/ (包含约30个文件)",
      "配置1个Supabase客户端: utils/supabase.js",
      "实现3个首页功能: [扫码连接, 手动输入IP连接, 设备状态展示]",
      "创建3个组件: [device-card设备卡片, health-tip健康小贴士, tabbar底部导航]",
      "实现2个服务模块: [services/device.js设备服务, services/user.js用户服务]",
      "配置4个TabBar页面: [首页, 检测, 档案, 我的]"
    ],
    "focus_paths": [
      "miniprogram/",
      "miniprogram/pages/index/",
      "miniprogram/pages/connect/",
      "miniprogram/components/",
      "miniprogram/services/"
    ],
    "acceptance": [
      "小程序项目可在开发者工具中打开: verify by 微信开发者工具加载无错误",
      "首页显示设备状态卡片: verify by 页面渲染device-card组件",
      "扫码连接功能可用: verify by wx.scanCode调用成功",
      "手动输入页面可跳转: verify by 点击手动输入按钮跳转到connect页面",
      "设备心跳检测10秒间隔: verify by console.log显示ping请求每10秒一次",
      "健康小贴士轮播显示: verify by Swiper组件自动播放"
    ],
    "depends_on": ["IMPL-001"],
    "artifacts": [
      {
        "type": "design_document",
        "path": "心音智鉴检测中心功能设计方案.md",
        "section": "一、首页模块 - 设备连接",
        "priority": "highest"
      }
    ]
  },
  "flow_control": {
    "pre_analysis": [
      {
        "step": "load_homepage_design",
        "action": "读取首页设计规范",
        "commands": ["Read(心音智鉴检测中心功能设计方案.md)"],
        "output_to": "homepage_design_spec",
        "on_error": "abort"
      }
    ],
    "implementation_approach": [
      {
        "step": 1,
        "title": "创建小程序项目骨架",
        "description": "初始化微信小程序项目结构",
        "modification_points": [
          "创建1个根配置: app.json (定义4个tabBar页面)",
          "创建1个全局样式: app.wxss (约100行CSS变量)",
          "创建1个入口文件: app.js (约80行生命周期)",
          "创建5个目录: [pages/, components/, services/, utils/, config/]"
        ],
        "logic_flow": [
          "定义全局配置和页面路由",
          "配置TabBar导航",
          "定义全局样式变量(颜色/字体/间距)",
          "初始化全局数据和方法"
        ],
        "depends_on": [],
        "output": "miniprogram_skeleton"
      },
      {
        "step": 2,
        "title": "配置Supabase客户端",
        "description": "封装Supabase SDK适配微信小程序",
        "modification_points": [
          "创建1个配置文件: config/supabase.js (约20行)",
          "创建1个客户端封装: utils/supabase.js (约100行)",
          "适配wx.request替代fetch"
        ],
        "logic_flow": [
          "配置Supabase URL和Key",
          "封装自定义fetch使用wx.request",
          "配置本地存储适配器"
        ],
        "depends_on": [1],
        "output": "supabase_client"
      },
      {
        "step": 3,
        "title": "实现设备服务模块",
        "description": "封装设备连接和状态管理逻辑",
        "modification_points": [
          "创建1个设备服务: services/device.js (约120行)",
          "实现5个方法: [connect(), disconnect(), ping(), getDeviceInfo(), parseQRCode()]"
        ],
        "logic_flow": [
          "解析二维码获取IP",
          "发起设备验证请求",
          "保存设备信息到本地",
          "启动心跳检测定时器",
          "处理断连重连逻辑"
        ],
        "depends_on": [2],
        "output": "device_service"
      },
      {
        "step": 4,
        "title": "创建设备卡片组件",
        "description": "实现三种状态的设备卡片UI",
        "modification_points": [
          "创建1个组件目录: components/device-card/",
          "创建4个组件文件: [index.js, index.json, index.wxml, index.wxss]",
          "实现3种状态样式: [未连接/灰色, 已连接/绿色, 断开/红色]"
        ],
        "logic_flow": [
          "定义组件属性(status, deviceInfo)",
          "根据状态渲染不同UI",
          "绑定点击事件触发重连"
        ],
        "depends_on": [],
        "output": "device_card_component"
      },
      {
        "step": 5,
        "title": "实现首页",
        "description": "开发首页设备连接功能",
        "modification_points": [
          "创建1个首页目录: pages/index/",
          "创建4个页面文件: [index.js约150行, index.json, index.wxml约80行, index.wxss约100行]",
          "实现2个连接入口: [扫码按钮, 手动输入按钮]"
        ],
        "logic_flow": [
          "页面加载获取设备连接状态",
          "点击扫码调用wx.scanCode",
          "解析二维码并连接设备",
          "更新设备卡片状态",
          "启动心跳检测"
        ],
        "depends_on": [3, 4],
        "output": "index_page"
      },
      {
        "step": 6,
        "title": "实现手动连接页",
        "description": "开发手动输入IP连接页面",
        "modification_points": [
          "创建1个连接页目录: pages/connect/",
          "创建4个页面文件: [index.js约100行, index.json, index.wxml约60行, index.wxss约80行]",
          "实现IP输入框和验证逻辑"
        ],
        "logic_flow": [
          "用户输入IP地址",
          "验证IP格式正确性",
          "调用设备连接服务",
          "连接成功返回首页"
        ],
        "depends_on": [3],
        "output": "connect_page"
      }
    ],
    "target_files": [
      "miniprogram/app.js",
      "miniprogram/app.json",
      "miniprogram/app.wxss",
      "miniprogram/config/supabase.js",
      "miniprogram/utils/supabase.js",
      "miniprogram/services/device.js",
      "miniprogram/services/user.js",
      "miniprogram/components/device-card/index.js",
      "miniprogram/components/device-card/index.wxml",
      "miniprogram/components/device-card/index.wxss",
      "miniprogram/pages/index/index.js",
      "miniprogram/pages/index/index.wxml",
      "miniprogram/pages/index/index.wxss",
      "miniprogram/pages/connect/index.js",
      "miniprogram/pages/connect/index.wxml"
    ]
  }
}
