<!-- Detection Recording Page Template -->
<view class="recording-page">
  <!-- 顶部Header -->
  <view class="header">
    <view class="header-spacer"></view>
    <view class="close-btn" bindtap="stopRecording">
      <icon-svg name="close" size="28" color="#666" />
    </view>
  </view>

  <!-- 核心内容区 -->
  <view class="main-content">
    <!-- 倒计时显示 -->
    <view class="countdown-section">
      <view class="countdown-ring-wrapper">
        <view class="countdown-ring">
          <view class="countdown-progress" style="--progress: {{progress}}%;"></view>
          <view class="countdown-inner">
            <text class="countdown-number">{{countdown}}</text>
            <text class="countdown-unit">剩余秒</text>
          </view>
        </view>
      </view>

      <!-- 阶段状态文字 -->
      <view class="status-wrapper">
        <text class="status-text">{{phaseText}}</text>
        <view class="status-dots" wx:if="{{isRecording}}">
          <view class="dot d1"></view>
          <view class="dot d2"></view>
          <view class="dot d3"></view>
        </view>
      </view>
    </view>

    <!-- 波形显示区 -->
    <view class="waveform-section">
      <view class="waveform-card">
        <!-- 波形头部 -->
        <view class="waveform-header">
          <view class="waveform-title">
            <icon-svg name="waveform" size="24" color="#1890FF" />
            <text class="waveform-label">实时心音</text>
          </view>
          <view class="waveform-indicator {{isRecording ? 'active' : ''}}">
            <view class="indicator-dot"></view>
            <text class="indicator-text">{{isRecording ? 'LIVE' : 'DEMO'}}</text>
          </view>
        </view>

        <!-- 波形Canvas -->
        <view class="waveform-container">
          <waveform
            height="130"
            lineColor="#1890FF"
            lineWidth="2.5"
            showDemo="{{!isRecording}}"
            bindready="onWaveformReady"
          ></waveform>
        </view>

        <!-- 心率整合到波形卡片底部 -->
        <view class="heart-rate-inline {{heartRate !== '--' ? 'show' : ''}}">
          <view class="hr-icon-wrapper">
            <icon-svg name="heart" size="20" color="#F44336" />
          </view>
          <text class="hr-value">{{heartRate}}</text>
          <text class="hr-unit">BPM</text>
          <text class="hr-status safe" wx:if="{{heartRate !== '--'}}">正常</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 底部区域 -->
  <view class="bottom-section">
    <!-- 进度条 -->
    <view class="progress-section">
      <view class="progress-bar-wrapper">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{progress}}%;"></view>
        </view>
      </view>
      <view class="progress-labels">
        <text class="progress-elapsed">已采集 {{elapsedTime}}秒</text>
        <text class="progress-total">共 {{totalDuration}}秒</text>
      </view>
    </view>

    <!-- 底部提示 -->
    <view class="tip-banner">
      <view class="tip-icon-wrapper">
        <icon-svg name="{{currentTip.icon}}" size="28" color="#1890FF" />
      </view>
      <text class="tip-text">{{currentTip.text}}</text>
    </view>
  </view>
</view>
