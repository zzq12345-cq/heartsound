<!-- Detection Recording Page Template -->
<view class="recording-page">
  <!-- Background effects -->
  <view class="bg-effects">
    <!-- Gradient overlay -->
    <view class="gradient-overlay"></view>

    <!-- Pulse circles -->
    <view class="pulse-bg">
      <view class="pulse-circle c1"></view>
      <view class="pulse-circle c2"></view>
      <view class="pulse-circle c3"></view>
      <view class="pulse-circle c4"></view>
    </view>

    <!-- Floating particles -->
    <view class="particles">
      <view class="particle p1"></view>
      <view class="particle p2"></view>
      <view class="particle p3"></view>
      <view class="particle p4"></view>
      <view class="particle p5"></view>
      <view class="particle p6"></view>
    </view>

    <!-- Sound waves decoration -->
    <view class="sound-waves" wx:if="{{isRecording}}">
      <view class="sound-wave sw1"></view>
      <view class="sound-wave sw2"></view>
      <view class="sound-wave sw3"></view>
    </view>
  </view>

  <!-- Header -->
  <view class="header">
    <view class="header-left">
      <view class="recording-badge {{isRecording ? 'active' : ''}}">
        <view class="rec-dot"></view>
        <text class="rec-text">{{isRecording ? 'REC' : 'READY'}}</text>
      </view>
    </view>
    <view class="close-btn" bindtap="stopRecording">
      <icon-svg name="close" size="28" color="rgba(255,255,255,0.8)" />
    </view>
  </view>

  <!-- Main content -->
  <view class="main-content">
    <!-- Countdown display -->
    <view class="countdown-section">
      <!-- Glow effect behind ring -->
      <view class="countdown-glow {{isRecording ? 'active' : ''}}"></view>

      <view class="countdown-ring-wrapper">
        <!-- Outer decorative ring -->
        <view class="countdown-ring-outer"></view>

        <!-- Progress ring -->
        <view class="countdown-ring">
          <!-- SVG-like progress using conic-gradient -->
          <view class="countdown-progress" style="--progress: {{progress}}%;"></view>

          <!-- Inner circle -->
          <view class="countdown-inner">
            <view class="countdown-inner-glow"></view>
            <text class="countdown-number">{{countdown}}</text>
            <text class="countdown-unit">秒</text>
          </view>
        </view>

        <!-- Tick marks around the ring -->
        <view class="ring-ticks">
          <view class="tick" wx:for="{{12}}" wx:key="index" style="transform: rotate({{index * 30}}deg);"></view>
        </view>
      </view>

      <view class="status-wrapper">
        <text class="status-text">{{statusText}}</text>
        <view class="status-dots" wx:if="{{isRecording}}">
          <view class="dot d1"></view>
          <view class="dot d2"></view>
          <view class="dot d3"></view>
        </view>
      </view>
    </view>

    <!-- Waveform display -->
    <view class="waveform-section">
      <view class="waveform-card">
        <!-- Waveform header -->
        <view class="waveform-header">
          <view class="waveform-title">
            <icon-svg name="waveform" size="24" color="#1890FF" />
            <text class="waveform-label">实时波形</text>
          </view>
          <view class="waveform-indicator {{isRecording ? 'active' : ''}}">
            <view class="indicator-dot"></view>
            <text class="indicator-text">{{isRecording ? 'LIVE' : 'DEMO'}}</text>
          </view>
        </view>

        <!-- Waveform canvas -->
        <view class="waveform-container">
          <view class="waveform-glow"></view>
          <waveform
            height="160"
            lineColor="#1890FF"
            lineWidth="2.5"
            showDemo="{{!isRecording}}"
            bindready="onWaveformReady"
          ></waveform>
          <!-- Grid overlay -->
          <view class="waveform-grid">
            <view class="grid-line horizontal" wx:for="{{4}}" wx:key="index"></view>
            <view class="grid-line vertical" wx:for="{{8}}" wx:key="index"></view>
          </view>
        </view>
      </view>
    </view>

    <!-- Heart rate display -->
    <view class="heart-rate-section {{heartRate !== '--' ? 'show' : ''}}">
      <view class="heart-rate-card">
        <view class="heart-icon-wrapper">
          <view class="heart-pulse"></view>
          <icon-svg name="heart" size="28" color="#F44336" class="heart-icon" />
        </view>
        <view class="heart-rate-info">
          <text class="heart-rate-value">{{heartRate}}</text>
          <text class="heart-rate-unit">BPM</text>
        </view>
        <view class="heart-rate-status">
          <text class="status-label">心率正常</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Bottom section -->
  <view class="bottom-section">
    <!-- Progress bar -->
    <view class="progress-section">
      <view class="progress-info">
        <text class="progress-label">采集进度</text>
        <text class="progress-percent">{{progressRound}}%</text>
      </view>
      <view class="progress-bar-wrapper">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{progress}}%;">
            <view class="progress-shine"></view>
          </view>
          <view class="progress-glow" style="left: {{progress}}%;"></view>
        </view>
      </view>
      <view class="progress-labels">
        <text class="progress-start">0秒</text>
        <text class="progress-current">{{totalDuration - countdown}}秒</text>
        <text class="progress-end">{{totalDuration}}秒</text>
      </view>
    </view>

    <!-- Tips -->
    <view class="tips-section">
      <view class="tip-card">
        <view class="tip-icon-wrapper">
          <icon-svg name="quiet" size="32" color="#36CFC9" />
        </view>
        <text class="tip-text">保持安静</text>
      </view>
      <view class="tip-card">
        <view class="tip-icon-wrapper">
          <icon-svg name="breathe" size="32" color="#36CFC9" />
        </view>
        <text class="tip-text">放松呼吸</text>
      </view>
      <view class="tip-card">
        <view class="tip-icon-wrapper">
          <icon-svg name="pin" size="32" color="#36CFC9" />
        </view>
        <text class="tip-text">保持位置</text>
      </view>
    </view>
  </view>
</view>
