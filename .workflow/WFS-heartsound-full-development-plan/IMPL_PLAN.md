---
identifier: WFS-heartsound-full-development-plan
source: "用户需求 - 心音智鉴完整开发计划"
analysis: .workflow/WFS-heartsound-full-development-plan/.process/context-package.json
design_document: 心音智鉴检测中心功能设计方案.md
---

# Implementation Plan: 心音智鉴完整开发计划

## Summary

心音智鉴是一款基于AI的心音检测微信小程序，通过树莓派边缘设备采集心音数据，结合深度学习模型进行实时分析，为家庭用户提供便捷的心脏健康自检服务。

**核心技术方案**:
- 边缘计算架构：树莓派本地AI推理，保护用户隐私
- 实时通信：WebSocket音频流传输，Canvas波形可视化
- 云端存储：Supabase BaaS服务，PostgreSQL + RLS安全策略
- AI健康助手：Dify自托管平台，DeepSeek LLM驱动

## Context Analysis

### 项目信息
- **项目名称**: 心音智鉴 (HeartSound)
- **项目阶段**: 设计完成，代码尚未开始
- **冲突风险**: 低 (绿地项目)

### 模块结构
| 模块 | 路径 | 技术栈 | 状态 |
|------|------|--------|------|
| 微信小程序用户端 | `miniprogram/` | WXML + WXSS + JS | 待创建 |
| 管理后台小程序 | `miniprogram-admin/` | WXML + WXSS + JS + ECharts | 待创建 |
| 树莓派后端 | `raspberry_pi/` | FastAPI + Python 3.11 | 待创建 |
| 云端数据库 | `supabase/` | PostgreSQL + RLS | 待配置 |
| AI平台 | `dify/` | Docker + DeepSeek | 待部署 |

### 依赖关系
```
IMPL-001 (Supabase)
    |
    +---> IMPL-004 (小程序首页) ---> IMPL-005 (检测流程) ---> IMPL-006 (档案+AI)
    |                                      ^
    |                                      |
    +---> IMPL-002 (FastAPI基础) ---> IMPL-003 (WebSocket+AI) ---+
    |
    +---> IMPL-007 (管理后台基础) ---> IMPL-008 (用户设备管理) ---> IMPL-009 (报表)

IMPL-010 (Dify部署) [无依赖，可与上述任务并行]
```

### 设计规范
| 类别 | 规范 |
|------|------|
| 主色 | #1890FF (品牌蓝) |
| 安全色 | #4CAF50 (绿) |
| 警告色 | #FF9800 (黄) |
| 危险色 | #F44336 (红) |
| 波形帧率 | >= 30fps |
| 页面切换 | <= 300ms |
| AI推理 | <= 5秒 |

## Brainstorming Artifacts

本项目基于完整的功能设计文档，无需额外的头脑风暴分析。

| 文档 | 路径 | 优先级 |
|------|------|--------|
| 功能设计方案 | `心音智鉴检测中心功能设计方案.md` | Highest |
| 项目索引 | `CLAUDE.md` | High |
| 上下文包 | `.workflow/.../context-package.json` | Medium |

## Task Breakdown

- **任务总数**: 10
- **层级结构**: 平面结构 (10个独立任务)
- **依赖类型**: 线性+并行混合

### 开发阶段映射

| 阶段 | 任务ID | 描述 | 预估工时 |
|------|--------|------|----------|
| Phase 1 | IMPL-001 | Supabase数据库配置 | 1-2天 |
| Phase 2 | IMPL-002, IMPL-003 | 树莓派FastAPI后端 | 3-5天 |
| Phase 3 | IMPL-004, IMPL-005, IMPL-006 | 微信小程序用户端 | 5-7天 |
| Phase 4 | IMPL-007, IMPL-008, IMPL-009 | 管理后台小程序 | 3-5天 |
| Phase 5 | IMPL-010 | Dify AI平台部署 | 2-3天 |

### 任务详情

#### IMPL-001: Supabase数据库配置与初始化
- **类型**: infrastructure
- **依赖**: 无
- **交付物**: 9个数据表 + 8条RLS策略 + 5个索引 + 初始数据

#### IMPL-002: 树莓派FastAPI后端 - 项目结构和设备API
- **类型**: feature
- **依赖**: 无
- **交付物**: FastAPI项目骨架 + 2个设备API + 4个数据模型

#### IMPL-003: 树莓派FastAPI后端 - WebSocket和AI推理
- **类型**: feature
- **依赖**: IMPL-002
- **交付物**: WebSocket音频流 + AI推理模块 + 检测API

#### IMPL-004: 微信小程序用户端 - 首页设备连接
- **类型**: feature
- **依赖**: IMPL-001
- **交付物**: 小程序项目结构 + 首页 + 设备连接功能

#### IMPL-005: 微信小程序用户端 - 检测流程四步骤
- **类型**: feature
- **依赖**: IMPL-003, IMPL-004
- **交付物**: 准备页 + 录制页 + 分析页 + 结果页 + 波形组件

#### IMPL-006: 微信小程序用户端 - 健康档案和AI助手
- **类型**: feature
- **依赖**: IMPL-005
- **交付物**: 历史记录 + AI对话 + 智能报告 + 个人中心

#### IMPL-007: 管理后台小程序 - 认证和数据看板
- **类型**: feature
- **依赖**: IMPL-001
- **交付物**: 管理后台骨架 + 登录认证 + 数据看板

#### IMPL-008: 管理后台小程序 - 用户和设备管理
- **类型**: feature
- **依赖**: IMPL-007
- **交付物**: 用户管理页面 + 设备管理页面 + 分配功能

#### IMPL-009: 管理后台小程序 - 报表导出
- **类型**: feature
- **依赖**: IMPL-008
- **交付物**: 报表导出页 + 历史报表 + Edge Function

#### IMPL-010: Dify AI平台部署和配置
- **类型**: infrastructure
- **依赖**: 无 (可与其他任务并行)
- **交付物**: Docker部署配置 + Chatflow + Workflow + 知识库

## Implementation Plan

### 执行策略

**推荐执行顺序**:
1. **并行执行**: IMPL-001 + IMPL-002 + IMPL-010 (无依赖，可同时开始)
2. **顺序执行**: IMPL-003 (依赖IMPL-002)
3. **并行执行**: IMPL-004 + IMPL-007 (依赖IMPL-001)
4. **顺序执行**: IMPL-005 (依赖IMPL-003, IMPL-004)
5. **顺序执行**: IMPL-006 + IMPL-008 (各自依赖前序任务，IMPL-006需要IMPL-010就绪)
6. **执行**: IMPL-009 (依赖IMPL-008)

### 资源需求

| 资源 | 说明 |
|------|------|
| 微信开发者工具 | 小程序开发调试 |
| Python 3.11+ | FastAPI后端开发 |
| Docker 24+ | Dify平台部署 |
| Supabase账户 | 云端数据库服务 |
| 树莓派设备 | 边缘计算设备测试 |

### 成功标准

| 验收项 | 标准 |
|--------|------|
| 设备连接 | 扫码/手动连接成功率 >= 99% |
| 波形显示 | 帧率 >= 30fps，无明显卡顿 |
| AI推理 | 响应时间 <= 5秒 |
| 数据安全 | RLS策略验证通过 |
| AI问答 | 所有回复包含免责声明 |

## Risk Mitigation

| 风险 | 缓解措施 |
|------|----------|
| WebSocket连接不稳定 | 实现重连机制，心跳检测 |
| AI模型推理慢 | 使用ONNX优化，边缘设备缓存 |
| 小程序审核风险 | 确保医疗免责声明完整 |
| Dify服务宕机 | 配置健康检查，降级提示 |

---

*Generated by Workflow Planning Agent*
*Session: WFS-heartsound-full-development-plan*
*Date: 2026-01-24*
