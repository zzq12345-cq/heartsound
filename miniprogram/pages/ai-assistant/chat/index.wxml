<!-- AI Health Assistant Chat Page -->
<!-- 设计语言：静谧医疗感 · 青蓝色点缀 · 雾面质感 -->

<!-- History Drawer Overlay -->
<view
  class="drawer-overlay {{showHistory ? 'visible' : ''}}"
  bindtap="closeHistory"
></view>

<!-- History Drawer -->
<view class="history-drawer {{showHistory ? 'open' : ''}}">
  <!-- Drawer Header -->
  <view class="drawer-header">
    <text class="drawer-title">历史对话</text>
    <view class="drawer-close" bindtap="closeHistory">
      <icon-svg name="close" size="32" color="#7A7D85" />
    </view>
  </view>

  <!-- New Chat Button -->
  <view class="new-chat-btn" bindtap="startNewChat">
    <icon-svg name="add" size="32" color="#FFFFFF" />
    <text class="new-chat-text">新建对话</text>
  </view>

  <!-- Conversation List -->
  <scroll-view class="conversation-list" scroll-y>
    <view wx:if="{{historyLoading}}" class="history-loading">
      <text class="history-loading-text">加载中...</text>
    </view>

    <view wx:elif="{{conversations.length === 0}}" class="history-empty">
      <icon-svg name="chat" size="64" color="#C2C7CF" />
      <text class="history-empty-text">暂无历史对话</text>
    </view>

    <block wx:else>
      <view
        class="conversation-item {{item.id === conversationId ? 'active' : ''}}"
        wx:for="{{conversations}}"
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="switchConversation"
        bindlongpress="onConversationLongPress"
      >
        <view class="conv-content">
          <text class="conv-name">{{item.name || '新对话'}}</text>
          <text class="conv-time">{{item.timeLabel}}</text>
        </view>
        <view
          class="conv-delete"
          catchtap="deleteConversation"
          data-id="{{item.id}}"
        >
          <icon-svg name="trash" size="28" color="#C2C7CF" />
        </view>
      </view>
    </block>
  </scroll-view>
</view>

<!-- Main Chat Container -->
<view class="chat-container">
  <!-- Header -->
  <view class="chat-header">
    <view class="header-left" bindtap="openHistory">
      <icon-svg name="menu" size="36" color="#5A5D66" />
    </view>
    <view class="header-title">
      <icon-svg name="robot" size="36" color="#2E8B8B" />
      <text class="title-text">健康助手</text>
    </view>
    <view class="header-right" bindtap="startNewChat">
      <icon-svg name="add" size="36" color="#5A5D66" />
    </view>
  </view>

  <!-- Messages List -->
  <scroll-view
    class="messages-container"
    scroll-y
    scroll-into-view="{{scrollToMessage}}"
    scroll-with-animation
  >
    <!-- Disclaimer Banner -->
    <view class="disclaimer-banner">
      <icon-svg name="alert" size="28" color="#C48A30" />
      <text class="disclaimer-text">{{disclaimer}}</text>
    </view>

    <!-- Messages -->
    <view class="messages-list">
      <block wx:for="{{messages}}" wx:key="id">
        <view id="{{item.id}}" class="message-item">
          <chat-bubble
            type="{{item.type}}"
            content="{{item.content}}"
            timestamp="{{item.timestamp}}"
            loading="{{item.loading}}"
            showDisclaimer="{{item.showDisclaimer}}"
            thinking="{{item.thinking}}"
            isThinking="{{item.isThinking}}"
          />
        </view>
      </block>
    </view>

    <!-- Quick Questions -->
    <view class="quick-questions" wx:if="{{showQuickQuestions && messages.length <= 1}}">
      <view class="quick-title">快捷问题</view>
      <view class="quick-list">
        <view
          class="quick-item"
          wx:for="{{quickQuestions}}"
          wx:key="*this"
          data-question="{{item}}"
          bindtap="onQuickQuestionTap"
        >
          <text class="quick-text">{{item}}</text>
          <icon-svg name="chevron-right" size="28" color="#C2C7CF" />
        </view>
      </view>
    </view>

    <!-- Bottom Spacing -->
    <view class="bottom-spacing"></view>
  </scroll-view>

  <!-- Input Area -->
  <view class="input-container">
    <view class="input-wrapper">
      <input
        class="message-input"
        type="text"
        placeholder="输入你的问题..."
        value="{{inputValue}}"
        bindinput="onInputChange"
        bindconfirm="sendMessage"
        confirm-type="send"
        disabled="{{loading}}"
      />
      <view
        class="send-btn {{inputValue.trim() && !loading ? 'active' : ''}}"
        bindtap="sendMessage"
      >
        <icon-svg name="send" size="36" color="{{inputValue.trim() && !loading ? '#FFFFFF' : '#C2C7CF'}}" />
      </view>
    </view>
  </view>
</view>
